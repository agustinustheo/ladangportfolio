<div id="workbookView" style="display: none; left: calc((100vw - 840px) / 2); top: calc((100vh - 594px) / 2); position: absolute;">
    <div class="lapor-book-a4">
        <% @pages = Dir.glob(File.join( Rails.root.join('app','assets', 'images', "#{session[:username]}/#{@thing.name}"), '**', '*')).select { |file| File.file?(file) }.count %>
        <% @count = 1 %>
        <% if @pages % 2 == 1 %>
            <% @pages += 1 %>
            <% (1..@pages).each do |i| %>
                    <% if i % 2 == 1 %>
                            <div class="lapor-page-container-a4">
                                <div class="lapor-page-a4">
                                        <div class="lapor-page-a4-front">
                                            <%= image_tag "#{session[:username]}/#{@thing.name}/#{@thing.name}_#{@pages-@count}.jpg", :class => "lapor-profile-resize" %>
                                        </div>
                            <% @count -= 1 %>
                    <% elsif i % 2 == 0 %>
                        <% if @count == 0 %>
                                <div class="lapor-page-a4-back">
                                </div>
                            </div>
                        </div>
                        <% else %>
                                <div class="lapor-page-a4-back">
                                    <%= image_tag "#{session[:username]}/#{@thing.name}/#{@thing.name}_#{@pages-@count}.jpg", :class => "lapor-profile-resize" %>
                                </div>
                            </div>
                        </div>
                        <% end %>
                        <% @count = @count + 3 %>
                    <% end %>
            <% end %>
        <% elsif @pages % 2 == 0 %>
            <% (1..@pages).each do |i| %>
                    <% if i % 2 == 1 %>
                            <div class="lapor-page-container-a4">
                                <div class="lapor-page-a4">
                                        <div class="lapor-page-a4-front">
                                            <%= image_tag "#{session[:username]}/#{@thing.name}/#{@thing.name}_#{@pages-@count}.jpg", :class => "lapor-profile-resize" %>
                                        </div>
                            <% @count -= 1 %>
                    <% elsif i % 2 == 0 %>
                        <% if @count == 0 %>
                                <div class="lapor-page-a4-back">
                                </div>
                            </div>
                        </div>
                        <% else %>
                                <div class="lapor-page-a4-back">
                                    <%= image_tag "#{session[:username]}/#{@thing.name}/#{@thing.name}_#{@pages-@count}.jpg", :class => "lapor-profile-resize" %>
                                </div>
                            </div>
                        </div>
                        <% end %>
                        <% @count = @count + 3 %>
                    <% end %>
            <% end %>
        <% end %>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function(){
        let count = 0;
        function moveBack(element){
            setTimeout(function(){
                $(element).css('z-index', 0);
                bindClickEvent();
            }, 800);
        }
        function bindClickEvent(){
            $('.lapor-page-container-a4').bind('click', function(){
                if($(this).hasClass('lapor-page-a4-turn')){
                    let currElement = $(this);
                    $(this).removeClass('lapor-page-a4-turn');
                    $('.lapor-page-container-a4').unbind();
                    moveBack(currElement);
                    count--;
                }
                else{
                    $(this).addClass('lapor-page-a4-turn');
                    $(this).css('z-index', count);
                    $('.lapor-page-container-a4').unbind();
                    setTimeout(function(){
                        bindClickEvent();
                    }, 800);
                    count++;
                }
            });
        }
        bindClickEvent();
    });
</script>